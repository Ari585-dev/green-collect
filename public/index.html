<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Iniciar Sesión | EcoPrisma</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-green-50 min-h-screen flex flex-col">

  <!-- Cabecera -->
  <header class="bg-white shadow-md p-4 flex justify-between items-center">
    <div class="flex items-center space-x-2">
      <span class="text-green-700 text-2xl">🌱</span>
      <span class="text-green-900 font-bold text-lg">EcoPrisma</span>
    </div>
    <nav class="space-x-6">
      <a href="#nosotros" class="text-green-800 hover:text-green-600 font-medium">Nosotros</a>
      <a href="#contacto" class="text-green-800 hover:text-green-600 font-medium">Contáctenos</a>
      <a href="#servicios" class="text-green-800 hover:text-green-600 font-medium">Servicios</a>
    </nav>
  </header>

  <!-- Contenido -->
  <main class="flex-grow flex justify-center items-center">
    <div class="bg-white shadow-lg rounded-lg p-8 w-full max-w-md">
      <h2 class="text-2xl font-bold text-center text-green-800 mb-6">Iniciar Sesión</h2>
      <form id="loginForm">
        <div class="mb-4">
          <label for="email" class="block text-sm font-semibold text-green-900 mb-1">Correo electrónico</label>
          <input type="email" id="email" class="w-full p-2 rounded border border-gray-300" placeholder="correo@ejemplo.com" required />
        </div>
        <div class="mb-6">
          <label for="password" class="block text-sm font-semibold text-green-900 mb-1">Contraseña</label>
          <input type="password" id="password" class="w-full p-2 rounded border border-gray-300" placeholder="********" required />
        </div>
        <button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-2 rounded">
          Ingresar
        </button>
      </form>

      <!-- Enlace a registro -->
      <div class="mt-4 text-center">
        <button id="registerBtn" class="text-green-700 font-semibold underline hover:text-green-900">
          ¿No tienes cuenta? Regístrate
        </button>
      </div>

      <!-- Mensaje de error -->
      <div id="message" class="mt-4 text-center text-red-600 font-medium"></div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="bg-white shadow p-6 mt-10">
    <div class="container mx-auto grid grid-cols-1 md:grid-cols-4 gap-6 text-sm text-gray-600">
      <div>
        <p class="font-bold mb-2">Síguenos en</p>
        <div class="flex space-x-3 text-xl text-gray-500">
          <a href="#"><i class="fab fa-facebook"></i>📘</a>
          <a href="#"><i class="fab fa-youtube"></i>▶️</a>
          <a href="#"><i class="fab fa-instagram"></i>📸</a>
        </div>
      </div>
      <div>
        <p class="font-bold mb-2">Recolectamos</p>
        <ul>
          <li><a href="#" class="hover:underline">Orgánicos</a></li>
          <li><a href="#" class="hover:underline">Inorgánicos reciclables</a></li>
          <li><a href="#" class="hover:underline">Peligrosos</a></li>
        </ul>
      </div>
      <div>
        <p class="font-bold mb-2">Trabaja con nosotros</p>
        <ul>
          <li><a href="#" class="hover:underline">Ofertas empleo</a></li>
          <li><a href="#" class="hover:underline">Personas</a></li>
          <li><a href="#" class="hover:underline">Corporativos</a></li>
        </ul>
      </div>
      <div>
        <p class="font-bold mb-2">Ayuda</p>
        <ul>
          <li><a href="#" class="hover:underline">Preguntas frecuentes</a></li>
          <li><a href="#" class="hover:underline">Contacto</a></li>
          <li><a href="#" class="hover:underline">PQRS</a></li>
        </ul>
      </div>
    </div>
  </footer>
  
  <!-- Esto es el fontawesome xd -->
  <script src="https://kit.fontawesome.com/a076d05399.js" crossorigin="anonymous"></script>
  

  <script>
    const form = document.getElementById('loginForm');
    const message = document.getElementById('message');
    const registerBtn = document.getElementById('registerBtn');

    registerBtn.addEventListener('click', () => {
      window.location.href = '/register.html';
    });

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      message.textContent = '';

      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;

      try {
        const res = await fetch('/login', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ email, password }),
        });

        const data = await res.json();

        if (!res.ok) {
          throw new Error(data.message || 'Error al iniciar sesión');
        }

        // console.log('😺', data)

        localStorage.setItem('token', data.token);        
        // message.textContent = 'Inicio de sesión exitoso';
        // message.classList.remove('text-red-600');
        // message.classList.add('text-green-600');

        const name = data.user.name;
        const userId = data.user.id;
        window.location.href = `/userview.html?name=${encodeURIComponent(name)}&userId=${encodeURIComponent(userId)}`;
      } catch (error) {
        message.textContent = error.message;
        message.classList.remove('text-green-600');
        message.classList.add('text-red-600');
      }
    });
  </script>
</body>
</html>
