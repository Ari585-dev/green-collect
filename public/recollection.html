<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Programar Recolecci√≥n | EcoPrisma</title>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col justify-between">

  <!-- Cabecera -->
  <header class="bg-white shadow-md p-4 flex justify-between items-center">
    <div class="flex items-center space-x-2">
      <span class="text-green-700 text-2xl">üå±</span>
      <span class="text-green-900 font-bold text-lg">EcoPrisma</span>
    </div>
    <nav class="space-x-6">
      <a href="#nosotros" class="text-green-800 hover:text-green-600 font-medium">Nosotros</a>
      <a href="#contacto" class="text-green-800 hover:text-green-600 font-medium">Cont√°ctenos</a>
      <a href="#servicios" class="text-green-800 hover:text-green-600 font-medium">Servicios</a>
    </nav>
  </header>

  <!-- Contenido principal -->
  <main class="flex-grow flex items-center justify-center mt-10">
    <div class="bg-white p-8 rounded-lg shadow-md w-full max-w-4xl">
      <h2 class="text-2xl font-bold mb-6 text-center text-green-700">
        Programaci√≥n de Recolecci√≥n <span id="userId"></span>
      </h2>

      <!-- Formulario -->
      <form id="recollectionForm">
        <div class="mb-4">
          <label for="date" class="block text-sm font-semibold text-green-900 mb-1">Fecha de recolecci√≥n</label>
          <input type="date" id="date" class="w-full p-2 rounded border border-gray-300" required />
        </div>
        <div class="mb-4">
          <label for="time" class="block text-sm font-semibold text-green-900 mb-1">Hora de recolecci√≥n</label>
          <input type="time" id="time" class="w-full p-2 rounded border border-gray-300" required />
        </div>
        <div class="mb-4">
          <label for="address" class="block text-sm font-semibold text-green-900 mb-1">Direcci√≥n de recolecci√≥n</label>
          <input type="text" id="address" class="w-full p-2 rounded border border-gray-300" placeholder="Calle Ejemplo 123" required />
        </div>
        <div class="mb-4">
          <label for="weight" class="block text-sm font-semibold text-green-900 mb-1">Peso estimado (kg)</label>
          <input type="number" step="0.01" id="weight" class="w-full p-2 rounded border border-gray-300" placeholder="Ej: 2.5" required />
        </div>
        <div class="mb-4">
          <label for="residueType" class="block text-sm font-semibold text-green-900 mb-1">Tipo de residuo</label>
          <select id="residueType" class="w-full p-2 rounded border border-gray-300" required>
            <option value="">Seleccione un tipo</option>
            <option value="Org√°nico">Org√°nico</option>
            <option value="Inorg√°nico reciclable">Inorg√°nico reciclable</option>
            <option value="Peligroso">Peligroso</option>
          </select>
        </div>
        <div class="mb-4">
          <label for="companyName" class="block text-sm font-semibold text-green-900 mb-1">Nombre de empresa recolectora</label>
          <input type="text" id="companyName" class="w-full p-2 rounded border border-gray-300" placeholder="Nombre de la empresa" required />
        </div>
        <div class="mb-4">
          <label for="description" class="block text-sm font-semibold text-green-900 mb-1">Descripci√≥n de los residuos</label>
          <textarea id="description" class="w-full p-2 rounded border border-gray-300" placeholder="Descripci√≥n de los residuos" required></textarea>
        </div>
        <button type="submit" class="w-full bg-green-600 hover:bg-green-700 text-white font-semibold py-2 rounded">
          Programar Recolecci√≥n
        </button>
      </form>
      

      <!-- Mensaje de √©xito o error -->
      <div id="message" class="mt-4 text-center text-sm"></div>

      <!-- Bot√≥n Volver -->
      <div class="mt-6 text-center">
        <button type="button" id="toBackBtn" class="text-green-600 hover:underline">Volver</button>
      </div>
    </div>
  </main>

  <!-- Footer -->
  <footer class="bg-white shadow p-6 mt-10">
    <div class="container mx-auto grid grid-cols-1 md:grid-cols-4 gap-6 text-sm text-gray-600">
      <div>
        <p class="font-bold mb-2">S√≠guenos en</p>
        <div class="flex space-x-3 text-xl text-gray-500">
          <a href="#">üìò</a>
          <a href="#">‚ñ∂Ô∏è</a>
          <a href="#">üì∏</a>
        </div>
      </div>
      <div>
        <p class="font-bold mb-2">Recolectamos</p>
        <ul>
          <li><a href="#" class="hover:underline">Org√°nicos</a></li>
          <li><a href="#" class="hover:underline">Inorg√°nicos reciclables</a></li>
          <li><a href="#" class="hover:underline">Peligrosos</a></li>
        </ul>
      </div>
      <div>
        <p class="font-bold mb-2">Trabaja con nosotros</p>
        <ul>
          <li><a href="#" class="hover:underline">Ofertas empleo</a></li>
          <li><a href="#" class="hover:underline">Personas</a></li>
          <li><a href="#" class="hover:underline">Corporativos</a></li>
        </ul>
      </div>
      <div>
        <p class="font-bold mb-2">Ayuda</p>
        <ul>
          <li><a href="#" class="hover:underline">Preguntas frecuentes</a></li>
          <li><a href="#" class="hover:underline">Contacto</a></li>
          <li><a href="#" class="hover:underline">PQRS</a></li>
        </ul>
      </div>
    </div>
  </footer>

  <!-- Script funcional -->
  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const name = urlParams.get('name');
    const userId = urlParams.get('userId');

    // Mostrar el userId en el t√≠tulo
    document.getElementById('userId').textContent = `| Usuario: ${name}`;

    // Bot√≥n volver
    const toBackBtn = document.getElementById('toBackBtn');
    toBackBtn.addEventListener('click', () => {
      window.location.href = `/userview.html?name=${encodeURIComponent(name)}&userId=${encodeURIComponent(userId)}`;
    });

    // Formulario
    const form = document.getElementById('recollectionForm');
    const message = document.getElementById('message');

    form.addEventListener('submit', async (e) => {
  e.preventDefault();

  const date = document.getElementById('date').value;
  const time = document.getElementById('time').value;
  const address = document.getElementById('address').value;
  const weight = parseFloat(document.getElementById('weight').value);
  const residueType = document.getElementById('residueType').value;
  const companyName = document.getElementById('companyName').value;
  const description = document.getElementById('description').value;

  // Concatenar fecha y hora para scheduled_date
  const formattedScheduledDate = `${date} ${time}`;

  const requestData = {
    user_id: Number(userId),
    scheduled_date: formattedScheduledDate,
    weight_kg: weight,
    residue_type: residueType,
    company_name: companyName
  };

  try {
    const response = await fetch('/requests/create', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      },
      body: JSON.stringify(requestData)
    });

    const data = await response.json();

    if (response.ok) {
      message.textContent = '‚úÖ ¬°Recolecci√≥n programada exitosamente!';
      message.className = 'text-green-600 mt-3 text-center text-sm';
      form.reset();
    } else {
      message.textContent = `‚ùå Error: ${data.message}`;
      message.className = 'text-red-600 mt-3 text-center text-sm';
    }
  } catch (error) {
    message.textContent = `‚ùå Error en la conexi√≥n: ${error.message}`;
    message.className = 'text-red-600 mt-3 text-center text-sm';
  }
});

  </script>
</body>
</html>
